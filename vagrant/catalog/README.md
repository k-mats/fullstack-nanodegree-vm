# Item Catalog Project Submission
This directory contains the submission of Item Catalog application project from FSND.

# Environment
This app needs the following language, framework and libraries.

- Python 2.7
- Flask
- Flask-HTTPAuth
- SQLite
- SQLAlchemy

The Vagrantfile preset by Udacity is bundled into this repository.

# Setup & run the app
This project has a [makefile](https://en.wikipedia.org/wiki/Makefile).  
You can invoke basic setups through this makefile in the Vagrant environment.

## Reset DB and run the application
The following commands initialize DB with dummy data and run the Flask application.
```sh
$ make
```
or
```sh
$ make all
```
They are the same as the combination of `make clean`, `make setup` and `make fill`. See the makefile for the detail.  
The dummy data come from [Wikipedia]https://en.wikipedia.org/wiki/Main_Page()'s articles.

## Run the application without dummy data
If you want to try the app with empty tables, execute the following command.
```sh
$ make empty-run
```

## Just run the application
It does nothing for DB.
```sh
$ make run
```

## Initialize DB with dummy data without running the app
```sh
$ make init
```

## Initialize DB to be empty without running the app
```sh
$ make reload
```

There are more commands in the makefile. See the makefile for the details of them.

# Authentication & Authorization
This app adopts Google OAuth2.

You have to log in with your Google account in order to create, edit or delete data.  
You can create, edit or delete data only if they are owned by you, that is, they are created by you.

# JSON API
This app has a web API returning you JSON data.

If you run the app on `localhost:5000`, you can access to the API just like `localhost:5000/api/v1/<path>`.

## Login
As with the web, you have to login in order to create, edit or delete data.

First, you need to get one-time code generated by Google in a browser accessing to `http://localhost:5000/api/v1/login`.  
After that, invoke the following command in a terminal.
```sh
$ curl -X POST -H 'Content-Type:application/json' -d '{"auth_code":"<ONE_TIME_CODE>"}' localhost:5000/api/v1/gconnect
```

It may take some time.  
If the command succeeds, you will get the credential token like the following.
```json
{
  "token": "<CREDENTIAL_TOKEN>"
}
```

Copy the credential token and use it when you create, edit or delete data through the API.

## Logout
The credential token expires in 10 minutes by default.

## Get the category list
```sh
$ curl localhost:5000/api/v1/
```

or

```sh
$ curl localhost:5000/api/v1/category/
{
  "categories": [
    {
      "id": 1,
      "name": "Baseball",
      "user_id": 1
    },
    {
      "id": 2,
      "name": "Tennis",
      "user_id": 1
    },
    ...
  ]
}
```

## Get a category
```sh
$ curl localhost:5000/api/v1/category/1/
{
  "category": {
    "id": 1,
    "name": "Baseball",
    "user_id": 1
  }
}
```

## Create new category
You need to specify new category's name as JSON format.  
If the command succeeds, you get the created category in JSON.

```sh
$ curl -u <CREDENTIAL_TOKEN>:blank -X POST -H 'Content-Type:application/json' -d '{"name":"Tennis"}' localhost:5000/api/v1/category/new
{
  "item": {
    "id": 4,
    "name": "Tennis",
    "user_id": 2
  }
}
```

## Edit a category
You need to specify edited category's name as JSON format.  
If the command succeeds, you get the edited category in JSON.

```sh
$ curl -u <CREDENTIAL_TOKEN>:blank -X POST -H 'Content-Type:application/json' -d '{"name":"Golf"}' localhost:5000/api/v1/category/4/edit
{
  "category": {
    "id": 4,
    "name": "Golf",
    "user_id": 2
  }
}
```

## Delete a category
If the command succeeds, you get the deleted category in JSON.
```sh
$ curl -u <CREDENTIAL_TOKEN>:blank -X POST localhost:5000/api/v1/category/1/delete
{
  "category": {
    "id": 1,
    "name": "Baseball",
    "user_id": 1
  }
}
```

## Get an item
```sh
$ curl localhost:5000/api/v1/category/1/item/1/
{
  "item": {
    "category_id": 1,
    "description": "A baseball bat is ...",
    "id": 1,
    "name": "Baseball bat",
    "user_id": 1
  }
}
```

## Create new item
You need to specify new item's name and description as JSON format.  
If the command succeeds, you get the created item in JSON.

```sh
$ curl -u <CREDENTIAL_TOKEN> -X POST -H 'Content-Type:application/json' -d '{"name":"Racket", "description": "The racket is..."}' localhost:5000/api/v1/category/4/item/new
{
  "item": {
    "category_id": 4,
    "description": "The racket is...",
    "id": 11,
    "name": "Racket",
    "user_id": 2
  }
}
```

## Edit an item
You need to specify edited item's name and description as JSON format.  
If the command succeeds, you get the edited item in JSON.

```sh
$ curl -u <CREDENTIAL_TOKEN>:blank -X POST -H 'Content-Type:application/json' -d '{"name":"Racket", "description": "Description is edited."}' localhost:5000/api/v1/category/4/item/11/edit
{
  "item": {
    "category_id": 4,
    "description": "Description is edited.",
    "id": 11,
    "name": "Racket",
    "user_id": 2
  }
}
```

## Delete an item
```sh
$ curl -u <CREDENTIAL_TOKEN>:blank -X POST localhost:5000/api/v1/category/4/item/11/delete
{
  "item": {
    "category_id": 4,
    "description": "The racket is...",
    "id": 11,
    "name": "Racket",
    "user_id": 2
  }
}
```

# Licenses
## Materialize
This app uses [Materialize](http://materializecss.com/) for the implementation of [Material Design](https://material.io/).  
Materialize is under MIT License.
For detail, see [Materialize's License document](https://github.com/Dogfalo/materialize/blob/master/LICENSE).
